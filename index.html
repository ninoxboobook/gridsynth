<!DOCTYPE html>
<html>

<head>
    <title>gridsynth - Sonifying the electricity grid</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="/js/main.js"></script>
    <script src="/js/data.js"></script>
    <script src="/js/controls.js"></script>
    <script src="/js/instruments.js"></script>
</head>

<body>
    <div id="p5-wrapper">
        <script>
            let backgroundDesktop;
            let backgroundTablet;
            let backgroundMobile;

            function preload() {
                backgroundDesktop = loadImage('/assets/gridsynth-bg-desktop.png');
                backgroundTablet = loadImage('/assets/gridsynth-bg-tablet.png');
                backgroundMobile = loadImage('/assets/gridsynth-bg-mobile.png');
            }

            function setup() {
                var canvas = createCanvas(windowWidth, windowHeight);
                canvas.parent("p5-wrapper");
                angleMode(DEGREES);
                frameRate(30);
            }
            var coalVolHistory = [];

            function draw() {
                let coalVol = coal.getLevelAtTime(Tone.now());
                coalVolHistory.push(coalVol);
                if (windowWidth < 480) {
                    background(backgroundMobile);
                } else if (windowWidth >= 480 && windowWidth < 768) {
                    background(backgroundTablet);
                } else {
                    background(backgroundDesktop);
                }

                stroke(255);
                noFill();
                strokeJoin(ROUND);
                strokeWeight(2);
                translate(width / 2, height / 2);
                beginShape();
                for (var i = 0; i < 360; i++) {
                    let r = map(coalVolHistory[i], 0, 1, 200, 220);
                    let x = r * cos(i);
                    let y = r * sin(i);

                    vertex(x, y);
                }
                endShape();

                if (coalVolHistory.length > 360) {
                    coalVolHistory.splice(0, 1);
                }

            }

            function windowResized() {
                resizeCanvas(windowWidth, windowHeight);
            }
        </script>
    </div>
    <div id="content-wrapper">
        <header role="banner">
            <h1 class="display">Gridsynth</h1>
            <nav role="navigation" aria-label="Main menu">
                <ul>
                    <li><a href="#about">About</a></li>
                </ul>
            </nav>
        </header>
        <main role="main">
            <button id="play-button" class="emphasis">Play</button>
            <button id="stop-button">Stop</button>
        </main>
    </div>

    <script src="/js/gridsynth.js"></script>
</body>

</html>